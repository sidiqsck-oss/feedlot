<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cattle Management PWA - Manajemen Ternak Sapi">
    <meta name="theme-color" content="#1a1a2e">
    <!-- Supabase configuration (replace with your values) -->
    <meta name="supabase-url" content="https://jzivugduojfrnkmvmytw.supabase.co">
    <meta name="supabase-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6aXZ1Z2R1b2pmcm5rbXZteXR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MjA3MDUsImV4cCI6MjA4NjE5NjcwNX0.bYIdDli1Weq-xbtoCGCRGF1bw9iTffpfZZwrULCR9uk">
    <title>Cattle Management System</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header Navigation -->
    <header class="header">
        <nav class="nav-menu">
            <button class="nav-btn active" data-module="induksi">
                <span class="nav-icon">üì¶</span>
                <span>Induksi</span>
            </button>
            <button class="nav-btn" data-module="reweight">
                <span class="nav-icon">üìä</span>
                <span>Reweight</span>
            </button>
            <button class="nav-btn" data-module="penjualan">
                <span class="nav-icon">üí∞</span>
                <span>Penjualan</span>
            </button>
        </nav>
        <button class="settings-btn" id="settingsBtn">
            <span>‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
    </header>

    <!-- Weight Display -->
    <div class="weight-display" id="weightDisplay">
        <div class="weight-value" id="weightValue">0.0</div>
        <div class="weight-unit">kg</div>
        <div class="weight-status" id="weightStatus">Disconnected</div>
    </div>

    <!-- Main Content Container -->
    <main class="main-content">
        <!-- Induksi Module -->
        <section class="module active" id="induksiModule">
            <div class="module-header">
                <h2>Data Induksi Sapi</h2>
            </div>

            <!-- Input Form -->
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Shipment</label>
                        <div class="select-with-add">
                            <select id="induksiShipment"></select>
                            <button class="add-btn" onclick="showAddModal('shipment')">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>RFID</label>
                        <input type="text" id="induksiRfid" placeholder="Scan atau input manual" maxlength="15">
                    </div>
                    <div class="form-group">
                        <label>Tanggal Induksi</label>
                        <input type="date" id="induksiTanggal">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Eartag</label>
                        <input type="text" id="induksiEartag" placeholder="Input eartag">
                    </div>
                    <div class="form-group">
                        <label>Berat Induksi (kg)</label>
                        <input type="number" id="induksiBerat" step="0.1" placeholder="Auto dari timbangan">
                    </div>
                    <div class="form-group">
                        <label>PEN</label>
                        <input type="text" id="induksiPen" placeholder="Input PEN">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Gigi</label>
                        <input type="text" id="induksiGigi" placeholder="Input gigi">
                    </div>
                    <div class="form-group">
                        <label>Frame</label>
                        <div class="select-with-add">
                            <select id="induksiFrame"></select>
                            <button class="add-btn" onclick="showAddModal('frame')">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Kode Property</label>
                        <div class="select-with-add">
                            <select id="induksiProperty"></select>
                            <button class="add-btn" onclick="showAddModal('property')">+</button>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Vitamin</label>
                        <input type="number" id="induksiVitamin" value="1" min="0">
                    </div>
                    <div class="form-group">
                        <label>Jenis Sapi</label>
                        <div class="select-with-add">
                            <select id="induksiJenis"></select>
                            <button class="add-btn" onclick="showAddModal('cattleType')">+</button>
                        </div>
                    </div>
                    <div class="form-group btn-group">
                        <button class="btn btn-primary" id="induksiSubmit">
                            <span>üì•</span> INPUT DATA
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="table-section">
                <div class="table-header">
                    <h3>Data Induksi</h3>
                    <div class="table-filter">
                        <label>Filter Shipment:</label>
                        <select id="induksiTableFilter">
                            <option value="">Semua Shipment</option>
                        </select>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="data-table" id="induksiTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="induksiSelectAll"></th>
                                <th>RFID</th>
                                <th>Eartag</th>
                                <th>Tanggal</th>
                                <th>Berat</th>
                                <th>PEN</th>
                                <th>Gigi</th>
                                <th>Frame</th>
                                <th>Property</th>
                                <th>Vitamin</th>
                                <th>Jenis</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="induksiTableBody"></tbody>
                    </table>
                </div>
                <div class="table-actions">
                    <button class="btn btn-danger" id="induksiDeleteSelected">üóëÔ∏è Hapus Terpilih</button>
                    <button class="btn btn-success" id="induksiExport">üìä Export Excel</button>
                    <button class="btn btn-secondary" id="induksiImport">üì• Import</button>
                    <input type="file" id="induksiImportFile" accept=".xlsx,.xls" hidden>
                    <button class="btn btn-outline" id="induksiTemplate">üìÑ Download Template</button>
                </div>
            </div>

            <!-- Summary Section -->
            <div class="summary-section">
                <div class="summary-header">
                    <h3>Summary per PEN</h3>
                    <div class="summary-actions">
                        <select id="induksiSummaryFilter">
                            <option value="">Semua Shipment</option>
                        </select>
                        <button class="btn btn-success" id="induksiSummaryExport">üìä Export Summary</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="summary-table" id="induksiSummaryTable">
                        <thead>
                            <tr>
                                <th>PEN</th>
                                <th>Jumlah Sapi</th>
                                <th>Total Berat (kg)</th>
                                <th>Avg Berat (kg)</th>
                                <th>Jenis Sapi</th>
                                <th>Frame</th>
                            </tr>
                        </thead>
                        <tbody id="induksiSummaryBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Reweight Module -->
        <section class="module" id="reweightModule">
            <div class="module-header">
                <h2>Data Reweight Sapi</h2>
            </div>

            <!-- Input Form -->
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>RFID</label>
                        <input type="text" id="reweightRfid" placeholder="Scan RFID" maxlength="15">
                    </div>
                    <div class="form-group">
                        <label>Tanggal Induksi</label>
                        <input type="date" id="reweightTglInduksi" readonly>
                    </div>
                    <div class="form-group">
                        <label>Tanggal Reweight</label>
                        <input type="date" id="reweightTanggal">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Eartag</label>
                        <input type="text" id="reweightEartag" readonly>
                    </div>
                    <div class="form-group">
                        <label>Shipment</label>
                        <input type="text" id="reweightShipment" readonly>
                    </div>
                    <div class="form-group">
                        <label>Berat Induksi (kg)</label>
                        <input type="number" id="reweightBeratInduksi" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Berat Reweight (kg)</label>
                        <input type="number" id="reweightBerat" step="0.1" placeholder="Auto dari timbangan">
                    </div>
                    <div class="form-group">
                        <label>PEN Induksi</label>
                        <input type="text" id="reweightPenInduksi" readonly>
                    </div>
                    <div class="form-group">
                        <label>PEN Awal Reweight</label>
                        <input type="text" id="reweightPenAwal" placeholder="Input PEN awal">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>PEN Akhir Reweight</label>
                        <input type="text" id="reweightPenAkhir" placeholder="Input PEN akhir">
                    </div>
                    <div class="form-group">
                        <label>DOF (Hari)</label>
                        <input type="number" id="reweightDof" readonly>
                    </div>
                    <div class="form-group">
                        <label>ADG (kg/hari)</label>
                        <input type="number" id="reweightAdg" step="0.001" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Frame</label>
                        <input type="text" id="reweightFrame" readonly>
                    </div>
                    <div class="form-group">
                        <label>Vitamin</label>
                        <input type="number" id="reweightVitamin" value="1" min="0">
                    </div>
                    <div class="form-group">
                        <label>Jenis Sapi</label>
                        <input type="text" id="reweightJenis" readonly>
                    </div>
                    <div class="form-group btn-group">
                        <button class="btn btn-primary" id="reweightSubmit">
                            <span>üì•</span> INPUT DATA
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="table-section">
                <div class="table-header">
                    <h3>Data Reweight</h3>
                    <div class="table-filter">
                        <label>Filter Shipment:</label>
                        <select id="reweightTableFilter">
                            <option value="">Semua Shipment</option>
                        </select>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="data-table" id="reweightTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="reweightSelectAll"></th>
                                <th>RFID</th>
                                <th>Eartag</th>
                                <th>Tgl Induksi</th>
                                <th>Tgl Reweight</th>
                                <th>Berat Awal</th>
                                <th>Berat Akhir</th>
                                <th>PEN Awal</th>
                                <th>PEN Akhir</th>
                                <th>DOF</th>
                                <th>ADG</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="reweightTableBody"></tbody>
                    </table>
                </div>
                <div class="table-actions">
                    <button class="btn btn-danger" id="reweightDeleteSelected">üóëÔ∏è Hapus Terpilih</button>
                    <button class="btn btn-success" id="reweightExport">üìä Export Excel</button>
                    <button class="btn btn-secondary" id="reweightImport">üì• Import</button>
                    <input type="file" id="reweightImportFile" accept=".xlsx,.xls" hidden>
                    <button class="btn btn-outline" id="reweightTemplate">üìÑ Download Template</button>
                </div>
            </div>

            <!-- Summary PEN Awal -->
            <div class="summary-section">
                <div class="summary-header">
                    <h3>Summary PEN Awal Reweight</h3>
                    <div class="summary-actions">
                        <select id="reweightSummaryAwalFilter">
                            <option value="">Semua Shipment</option>
                        </select>
                        <button class="btn btn-success" id="reweightSummaryAwalExport">üìä Export</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="summary-table" id="reweightSummaryAwalTable">
                        <thead>
                            <tr>
                                <th>PEN Awal</th>
                                <th>Jumlah</th>
                                <th>Total Berat</th>
                                <th>Avg Berat</th>
                                <th>Avg ADG</th>
                                <th>Jenis Sapi</th>
                            </tr>
                        </thead>
                        <tbody id="reweightSummaryAwalBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Summary PEN Akhir -->
            <div class="summary-section">
                <div class="summary-header">
                    <h3>Summary PEN Akhir Reweight</h3>
                    <div class="summary-actions">
                        <select id="reweightSummaryAkhirFilter">
                            <option value="">Semua Shipment</option>
                        </select>
                        <button class="btn btn-success" id="reweightSummaryAkhirExport">üìä Export</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="summary-table" id="reweightSummaryAkhirTable">
                        <thead>
                            <tr>
                                <th>PEN Akhir</th>
                                <th>Jumlah</th>
                                <th>Total Berat</th>
                                <th>Avg Berat</th>
                                <th>Avg ADG</th>
                                <th>Jenis Sapi</th>
                            </tr>
                        </thead>
                        <tbody id="reweightSummaryAkhirBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Penjualan Module -->
        <section class="module" id="penjualanModule">
            <div class="module-header">
                <h2>Data Penjualan Sapi</h2>
            </div>

            <!-- Input Form -->
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Pembeli</label>
                        <div class="select-with-add">
                            <select id="penjualanPembeli"></select>
                            <button class="add-btn" onclick="showAddModal('buyer')">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>RFID</label>
                        <input type="text" id="penjualanRfid" placeholder="Scan RFID" maxlength="15">
                    </div>
                    <div class="form-group">
                        <label>Tanggal Jual</label>
                        <input type="date" id="penjualanTanggal">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Eartag</label>
                        <input type="text" id="penjualanEartag" readonly>
                    </div>
                    <div class="form-group">
                        <label>Shipment</label>
                        <input type="text" id="penjualanShipment" readonly>
                    </div>
                    <div class="form-group">
                        <label>Berat Jual (kg)</label>
                        <input type="number" id="penjualanBerat" step="0.1" placeholder="Auto dari timbangan">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group btn-group">
                        <button class="btn btn-primary" id="penjualanSubmit">
                            <span>üì•</span> TAMBAH KE LIST
                        </button>
                        <button class="btn btn-secondary" id="penjualanClear">
                            <span>üîÑ</span> CLEAR
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sales List Table -->
            <div class="table-section">
                <div class="table-header">
                    <h3>List Penjualan</h3>
                </div>
                <div class="table-wrapper">
                    <table class="data-table" id="penjualanTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>RFID</th>
                                <th>Eartag</th>
                                <th>Shipment</th>
                                <th>Berat Jual</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="penjualanTableBody"></tbody>
                    </table>
                </div>
                <div class="table-actions">
                    <button class="btn btn-outline" id="penjualanPrintSettings">üñ®Ô∏è Print Settings</button>
                    <button class="btn btn-primary" id="penjualanPrintInvoice">üìÑ Print Invoice (PDF)</button>
                    <button class="btn btn-success" id="penjualanExportStaff">üìä Export Staff Excel</button>
                </div>
            </div>

            <!-- Sales History -->
            <div class="table-section">
                <div class="table-header">
                    <h3>Riwayat Penjualan</h3>
                </div>
                <div class="table-wrapper">
                    <table class="data-table" id="salesHistoryTable">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Pembeli</th>
                                <th>Jumlah Sapi</th>
                                <th>Total Berat</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="salesHistoryBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Pengaturan Koneksi</h3>
                <button class="close-btn" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="connection-section">
                    <h4>Scanner RS232</h4>
                    <div class="connection-status">
                        <span class="status-dot" id="scannerStatusDot"></span>
                        <span id="scannerStatusText">Disconnected</span>
                    </div>
                    <button class="btn btn-primary" id="connectScanner">üîå Connect Scanner</button>
                    <button class="btn btn-danger" id="disconnectScanner" disabled>‚ùå Disconnect</button>
                </div>
                <div class="connection-section">
                    <h4>Timbangan Digital</h4>
                    <div class="connection-status">
                        <span class="status-dot" id="scaleStatusDot"></span>
                        <span id="scaleStatusText">Disconnected</span>
                    </div>
                    <button class="btn btn-primary" id="connectScale">üîå Connect Scale</button>
                    <button class="btn btn-danger" id="disconnectScale" disabled>‚ùå Disconnect</button>
                </div>
                <div class="connection-section">
                    <h4>Supabase Sync</h4>
                    <div class="connection-status">
                        <span class="status-dot" id="supabaseStatusDot"></span>
                        <span id="supabaseStatusText">Not Configured</span>
                    </div>
                    <div style="display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap;">
                        <button class="btn btn-primary" id="supabasePush">‚§¥Ô∏è Push (Upload)</button>
                        <button class="btn btn-secondary" id="supabasePull">‚§µÔ∏è Pull (Download)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="addModalTitle">Tambah Item</h3>
                <button class="close-btn" onclick="closeModal('addModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="addModalLabel">Nama</label>
                    <input type="text" id="addModalInput" placeholder="Masukkan nama">
                </div>
                <button class="btn btn-primary" id="addModalSubmit">Tambah</button>
            </div>
        </div>
    </div>

    <!-- Print Settings Modal -->
    <div class="modal" id="printSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üñ®Ô∏è Print Settings</h3>
                <button class="close-btn" onclick="closeModal('printSettingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Header Text</label>
                    <input type="text" id="printHeader" placeholder="Nama Perusahaan">
                </div>
                <div class="form-group">
                    <label>Alamat</label>
                    <textarea id="printAddress" rows="2" placeholder="Alamat lengkap"></textarea>
                </div>
                <div class="form-group">
                    <label>Logo</label>
                    <input type="file" id="printLogo" accept="image/*">
                    <img id="printLogoPreview" class="logo-preview" style="display:none;">
                </div>
                <div class="form-group">
                    <label>Page Size</label>
                    <select id="printPageSize">
                        <option value="a4">A4</option>
                        <option value="letter">Letter</option>
                        <option value="legal">Legal</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="savePrintSettings">üíæ Simpan Settings</button>
            </div>
        </div>
    </div>

            <!-- Confirm Modal -->
            <div class="modal" id="confirmModal">
                <div class="modal-content modal-small">
                    <div class="modal-header">
                        <h3 id="confirmModalTitle">Konfirmasi</h3>
                        <button class="close-btn" id="confirmCloseBtn">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p id="confirmModalMessage">Apakah Anda yakin?</p>
                        <div style="display:flex;gap:.5rem;justify-content:flex-end;margin-top:1rem;">
                            <button class="btn btn-secondary" id="confirmCancel">Batal</button>
                            <button class="btn btn-danger" id="confirmOk">Lanjutkan</button>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/database.js"></script>
    <script src="js/serial.js"></script>
    <script src="js/induksi.js"></script>
    <script src="js/reweight.js"></script>
    <script src="js/penjualan.js"></script>
    <script src="js/app.js"></script>
</body>

</html>